<!doctype html><html lang=en dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="In this section, we describe how to uniformly sample from different groups using rejection sampling.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content>
<meta property="og:description" content="In this section, we describe how to uniformly sample from different groups using rejection sampling.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.zkdocs.com/docs/zkdocs/protocol-primitives/random-sampling/"><meta property="article:section" content="docs">
<title>Random Sampling | ZKDocs</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.c8710a7ee94192e48449fd4ec6671dcefe3aa106844b835a6a46d1754d1839ec.css integrity="sha256-yHEKfulBkuSESf1Oxmcdzv46oQaES4NaakbRdU0YOew=" crossorigin=anonymous>
<script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.8bbc0f9a49877bd2477f0bc1ab044c8d4228a6b06cb4338d6fcd6bf5cffbabc3.js integrity="sha256-i7wPmkmHe9JHfwvBqwRMjUIoprBstDONb81r9c/7q8M=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-215689345-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>ZKDocs</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li class=book-section-flat>
<a href=https://www.zkdocs.com/docs/zkdocs/>Introduction</a>
<ul>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/notation/>Notation & Definitions</a>
</li>
<li class=book-section-flat>
<a href=https://www.zkdocs.com/docs/zkdocs/zero-knowledge-protocols/>Zero-knowledge protocols</a>
<ul>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/zero-knowledge-protocols/schnorr/>Schnorr's identification protocol</a>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/zero-knowledge-protocols/schnorr-variants/>Variants of Schnorr's identification protocol</a>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/zero-knowledge-protocols/product-primes/>Number is product of two primes</a>
<ul>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/zero-knowledge-protocols/product-primes/square-freeness/>Number is square-free</a>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/zero-knowledge-protocols/product-primes/two-prime-divisors/>Two prime divisors</a>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/zero-knowledge-protocols/product-primes/product-of-two-primes/>Product of two primes</a>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/zero-knowledge-protocols/product-primes/paillier_blum_modulus/>Paillier-Blum Modulus</a>
</li>
</ul>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/zero-knowledge-protocols/girault-identification/>Girault's identification protocol</a>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/zero-knowledge-protocols/short-factoring-proofs/>Short factoring proofs</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<a href=https://www.zkdocs.com/docs/zkdocs/security-of-zkps/>Security of ZKPs</a>
<ul>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/security-of-zkps/when-to-use-hvzk/>Using HVZKP in the wrong context</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<a href=https://www.zkdocs.com/docs/zkdocs/protocol-primitives/>Protocol primitives</a>
<ul>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/protocol-primitives/random-sampling/ class=active>Random Sampling</a>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/protocol-primitives/fiat-shamir/>Fiat-Shamir transformation</a>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/protocol-primitives/nums/>Nothing-up-my-sleeve constructions</a>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/protocol-primitives/shamir/>Shamir's Secret Sharing Scheme</a>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/protocol-primitives/verifiable-secret-sharing/>Feldman's Verifiable Secret Sharing</a>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/protocol-primitives/alt-shamir/>Alternative versions of Shamir's Secret Sharing scheme</a>
</li>
</ul>
</li>
<li>
<a href=https://www.zkdocs.com/docs/zkdocs/bibliography/>Bibliography</a>
</li>
</ul>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<script type=text/x-mathjax-config>
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},SVG: {addMMLclasses: true},
  loader: { load: ['[tex]/textmacros','[tex]/newcommand','[tex]/action'] },
  tex: { packages: { '[+]': ['newcommand','action', 'textmacros'] } }
});
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS_CHTML-full"></script>
<script language=javascript type=text/javascript src=/js/interactive_variables.js></script>
<script>MathJax.Hub.Queue(function(){setupInteractiveVariables()})</script>
$\newcommand{\alicebob}[3]{#1 & \ra{#2} & #3\\[-5pt]}$
$\newcommand{\bobalice}[3]{#1 & \la{#2} & #3\\[-5pt]}$
$\newcommand{\alicework}[1]{#1 & &\\[-5pt]}$
$\newcommand{\bobwork}[1]{ & & #1\\[-5pt]}$
$\newcommand{\work}[2]{#1 & & #2\\}$
$\newcommand{\allwork}[1]{ & #1 & \\}$
$\newcommand{\aliceseparator}{-------&&\\}$
$\newcommand{\bobseparator}{&&-------\\}$
$\newcommand{\foo}{\phantom{\text{bigarrowfitsallthis}}}$
$\newcommand{\ra}[1]{%
\vphantom{\xrightarrow{asd}}%
\smash{\xrightarrow[\foo]{#1}}%
}$
$\newcommand{\la}[1]{%
\vphantom{\xleftarrow{asd}}%
\smash{\xleftarrow[\foo]{#1}}%
}$
$\newcommand{\z}[1]{\mathbb{Z}_{#1}}$
$\newcommand{\zq}{\mathbb{Z}_\varq}$
$\newcommand{\zqs}{\mathbb{Z}_q^\ast}$
$\newcommand{\zns}[1]{\mathbb{Z}_{#1}^\ast}$
$\require{action}
\newcommand{\sampleSymb}{
{\overset{\$}{\leftarrow}}
}$
$\newcommand{\field}[1]{\mathbb{F}_{#1}}$
$\newcommand{\sample}[1]{#1\sampleSymb\zq}$
$\newcommand{\sampleGeneric}[2]{#1\sampleSymb#2}$
$\newcommand{\sampleInterval}[2]{#1\sampleSymb\interval{#2}}$
$\newcommand{\sampleRange}[2]{#1\sampleSymb\range{#2}}$
$\newcommand{\samplezqs}[1]{\class{hover}{#1\sampleSymb\zqs}}$
$\newcommand{\sampleN}[2]{\class{hover}{#1\sampleSymb\z{#2}}}$
$\newcommand{\sampleNs}[2]{\class{hover}{#1\sampleSymb\z{#2}^\ast}}$
$\newcommand{\equalQ}{\overset{?}{=}}$
$\newcommand{\gQ}{\overset{?}{>}}$
$\newcommand{\inQ}{\overset{?}{\in}}$
$\newcommand{\cgroup}{\mathbb{G}}$
$\newcommand{\hash}[1]{\mathsf{Hash}({#1})}$
$\newcommand{\hashbit}[2]{\mathsf{Hash}({#1})\verb+[0:#2]+}$
$\newcommand{\naturals}{\mathbb{N}}$
$\newcommand{\sqfree}{L_\mathsf{square-free}}$
$\newcommand{\ceil}[1]{\lceil #1 \rceil}$
$\newcommand{\sampleSet}[2]{\class{hover}{#1\sampleSymb#2}}$
$\newcommand{\bunch}[1]{\{ #1_i\}_{i=1}^m}$
$\newcommand{\bunchi}[1]{\{ #1\}_{i=1}^m}$
$\newcommand{\forb}{\text{ for }i=1,\ldots,m}$
$\newcommand{\interval}[1]{[0, #1[}$
$\newcommand{\range}[1]{[#1]}$
$\newcommand{\rangeone}[1]{\{1, \dots,#1 -1 \}}$
$\newcommand{\vara}{\class{var var_a}{a}}$
$\newcommand{\varb}{\class{var var_b}{b}}$
$\newcommand{\varc}{\class{var var_c}{c}}$
$\newcommand{\vard}{\class{var var_d}{d}}$
$\newcommand{\varh}{\class{var var_h}{h}}$
$\newcommand{\varg}{\class{var var_g}{g}}$
$\newcommand{\varu}{\class{var var_u}{u}}$
$\newcommand{\varx}{\class{var var_x}{x}}$
$\newcommand{\varX}{\class{var var_X}{X}}$
$\newcommand{\varz}{\class{var var_z}{z}}$
$\newcommand{\varr}{\class{var var_r}{r}}$
$\newcommand{\varq}{\class{var var_q}{q}}$
$\newcommand{\varp}{\class{var var_p}{p}}$
$\newcommand{\vare}{\class{var var_e}{e}}$
$\newcommand{\vary}{\class{var var_y}{y}}$
$\newcommand{\varw}{\class{var var_w}{w}}$
$\newcommand{\varprover}{\class{var var_Prover}{\text{Prover}}}$
$\newcommand{\varprover}{\class{var var_Prover}{\text{Prover}}}$
$\newcommand{\varverifier}{\class{var var_Verifier}{\text{Verifier}}}$
$\newcommand{\varN}{\class{var var_N}{N}}$
$\newcommand{\rhovar}{\class{var var_ρ}{\rho}}$
$\newcommand{\sigmavar}{\class{var var_σ}{\sigma}}$
$\newcommand{\thetavar}{\class{var var_θ}{\theta}}$
$\newcommand{\muvar}{\class{var var_μ}{\mu}}$
$\newcommand{\true}{\mathsf{true}}$
$\newcommand{\false}{\mathsf{false}}$
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Random Sampling</strong>
<label for=toc-control>
<img src=/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#uniform-sampling-in-zq>Uniform sampling in $\zq$</a></li>
<li><a href=#rejection-sampling>Rejection sampling</a></li>
<li><a href=#uniform-sampling-in-zqs>Uniform sampling in $\zqs$</a></li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=random-sampling>
Random sampling
<a class=anchor href=#random-sampling>#</a>
</h1>
<p>In most protocols, it is required to sample uniformly from groups like $\zq$ or $\zqs$. Here we will describe how to sample in these specific groups, and a general procedure to sample via rejection sampling.</p>
<h2 id=uniform-sampling-in-zq>
Uniform sampling in $\zq$
<a class=anchor href=#uniform-sampling-in-zq>#</a>
</h2>
<p>Since we identify the elements of $\zq$ with the set of integers $\range{q}$, to uniformly sample
we only need to sample from the set $\range{q}$.</p>
<p>We should always use a suitable cryptographic random number library to sample uniformly. For instance,
in python, we can use <a href=https://docs.python.org/3/library/secrets.html>secrets</a>.</p>
<div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#007020;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>secrets</span>

<span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>sample_Zq</span>():
    <span style=color:#007020;font-weight:700>return</span> secrets<span style=color:#666>.</span>randbelow(q)
</code></pre></td></tr></table>
</div>
</div><blockquote class="book-hint danger">
<p><strong>Never do this:</strong> When you only have access to sampling elements of a fixed bit-size but want to sample over $\z{1337}$ do not do this:</p>
<div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>wrong_sampling</span>():
    <span style=color:#007020;font-weight:700>return</span> sample_32_bits() <span style=color:#666>%</span> <span style=color:#40a070>1337</span>
</code></pre></td></tr></table>
</div>
</div><p>The <code>wrong_sampling</code> function introduces <em>modulo-bias</em> in the generation of elements, and some elements will be more likely to appear than others. In these cases you need to use <a href=#sampling-from-any-set-via-rejection-sampling>rejection sampling</a>.</p>
</blockquote>
<h2 id=rejection-sampling>
Rejection sampling
<a class=anchor href=#rejection-sampling>#</a>
</h2>
<p>Suppose we know how to sample from a set $S$ and would like to sample from a subset $T\subseteq S$.
To do this, we need to check membership in $T$ and perform rejection sampling. In a loop:</p>
<ol>
<li>sample element $e \in S$.</li>
<li>if $e \in T$, return $e$, otherwise repeat step 1.</li>
</ol>
<p>This is how we must perform sampling in $\zq$ if we cannot use a library like <code>secrets</code>.
In this case, rejection sampling would look like this:</p>
<div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>correct_sampling</span>():
    <span style=color:#007020;font-weight:700>while</span> <span style=color:#007020;font-weight:700>True</span>:
        e <span style=color:#666>=</span> sample_32_bits()
        <span style=color:#007020;font-weight:700>if</span> e <span style=color:#666>&gt;=</span> <span style=color:#40a070>0</span> <span style=color:#007020;font-weight:700>and</span> e <span style=color:#666>&lt;</span> <span style=color:#40a070>1337</span>:
            <span style=color:#007020;font-weight:700>return</span> e
</code></pre></td></tr></table>
</div>
</div><p>Depending on the set we can sample from, this method can take longer, but in practice, we should always be able to sample from spaces only slightly larger than our target space.</p>
<h2 id=uniform-sampling-in-zqs>
Uniform sampling in $\zqs$
<a class=anchor href=#uniform-sampling-in-zqs>#</a>
</h2>
<p>Sampling in $\zqs$ requires an extra step. The elements of $\zqs$ are the elements invertible modulo $q$ and for $e$ to be invertible means that $\gcd(e, q) = 1$.
So, to obtain these elements we need to perform rejection sampling. In a loop,</p>
<ol>
<li>sample element $e \in \zq$ using <a href=#uniform-sampling-in-zq>the previous section</a>.</li>
<li>if $\gcd(e, q) = 1$ return $e$, otherwise repeat step 1.</li>
</ol>
<div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#007020;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>secrets</span>
<span style=color:#007020;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>math</span>

<span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>sample_Zqstar</span>():
    <span style=color:#007020;font-weight:700>while</span> <span style=color:#007020;font-weight:700>True</span>:
        e <span style=color:#666>=</span> sample_Zq()
        <span style=color:#007020;font-weight:700>if</span> math<span style=color:#666>.</span>gcd(e, q) <span style=color:#666>==</span> <span style=color:#40a070>1</span>:
            <span style=color:#007020;font-weight:700>return</span> e
</code></pre></td></tr></table>
</div>
</div><blockquote class="book-hint info">
<strong>Note:</strong>
Since $\gcd(0, q)$ is never 1, we can sample $e$ from the set $\rangeone{q}$.
</blockquote>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
<article class=markdown>
<br>
<br>
<hr>
<div style=text-align:right>
<a href=https://github.com/trailofbits/zkdocs target=_blank>View on Github</a> | <a href=https://www.trailofbits.com/ target=_blank>Trail of Bits</a> |
<a href=https://blog.trailofbits.com/ target=_blank>Trail of Bits Blog</a>
</div>
<div style=text-align:right>
<small>ZKDocs content is licensed under a <a href=https://creativecommons.org/licenses/by/4.0/ target=_blank>Creative Commons Attribution 4.0 International license.</a></small>
</div>
</article>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#uniform-sampling-in-zq>Uniform sampling in $\zq$</a></li>
<li><a href=#rejection-sampling>Rejection sampling</a></li>
<li><a href=#uniform-sampling-in-zqs>Uniform sampling in $\zqs$</a></li>
</ul>
</nav>
<br>
<br>
</div>
</aside>
</main>
</body>
</html>